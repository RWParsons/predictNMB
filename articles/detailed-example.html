<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="predictNMB">
<title>Detailed example: pressure injury model • predictNMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Detailed example: pressure injury model">
<meta property="og:description" content="predictNMB">
<meta property="og:image" content="https://rwparsons.github.io/predictNMB/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">predictNMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/creating-nmb-functions.html">Creating NMB functions</a>
    <a class="dropdown-item" href="../articles/detailed-example.html">Detailed example: pressure injury model</a>
    <a class="dropdown-item" href="../articles/introduction-to-predictNMB.html">Introduction to predictNMB</a>
    <a class="dropdown-item" href="../articles/summarising-results-with-predictNMB.html">Summarising results from predictNMB</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rwparsons/predictNMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Detailed example: pressure injury model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rwparsons/predictNMB/blob/HEAD/vignettes/detailed-example.Rmd" class="external-link"><code>vignettes/detailed-example.Rmd</code></a></small>
      <div class="d-none name"><code>detailed-example.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="detailed-example">Detailed example<a class="anchor" aria-label="anchor" href="#detailed-example"></a>
</h2>
<p>Economic analyses often combine information from a variety of
sources, including randomised controlled trials, costing studies, and
local data. An advantage of simulation is that it can estimate the
utility of a proposed intervention prior to implementation.</p>
<p>In this example, we simulate the decision process for an analyst at a
hospital with a high rate of pressure injuries (or bedsores), also known
as pressure ulcers. Pressure ulcers are considered significant adverse
events for patients, often leading to additional discomfort, prolonged
length of hospital stay, and increased costs. The hospital currently
uses pressure ulcer prevention interventions routinely, but our analyst
is examining whether to implement a new clinical prediction model to
identify patients who may not benefit from existing interventions and
provide decision support to reduce non-beneficial care.</p>
<p>Let’s begin by generating some realistic costs and probabilities.
Keep in mind, we are trying to avoid a negative event, so the net
monetary benefit of every strategy in this scenario is going to be
negative. In this case, negative values will represent costs, we aim to
maximise these values (reduce costs). If we were also interested in
improving quality of life, we could estimate quality-adjusted life years
(QALYs), multiply them by a willingness-to-pay threshold (WTP), and add
this gain or loss to our true positive and false negative estimates to
signify the impact on the patient. For simplicity, let’s say we’re only
interested in hospital costs.</p>
<p>Model inputs: <br> - Mean incremental cost per pressure injury:
$8,000 (SD 550) <br> - Per-patient cost of pressure ulcer prevention
intervention (PUP): $140 (SD 20) <br> - Odds ratio of pressure ulcer
with intervention compared to non-intervention: 0.96 (SD 0.03) <br> -
AUC: 0.82 (SD 0.02) <br> - Hypothetical hospital pressure injury
incidence/event rate: 0.1 (SD 0.02) <br></p>
<p>With these inputs, we can populate our confusion matrix (2x2 table),
which helps us understand the outcomes resulting from correct and
incorrect predictions.</p>
<div class="section level3">
<h3 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h3>
<p>First, we need to define our NMB function, which provides data for
our simulation. In this case, the intervention is associated with a 4%
reduction in the odds of a pressure ulcer. We can use a
probability-weighted cost saving for successful prevention, at
8000*(0.96) = a small improvement of around $320. After including $140
in intervention costs, the net benefit is around $180 for a successfully
prevented pressure ulcer.</p>
<p>The AUC is 0.82, which represents the proportion of random positive
patients that received a higher probability of an injury than random
negative patients (and vice versa). A useful property of the AUC is that
it is the same no matter what probability threshold we use. In our case,
an AUC of 0.82 means that the model will assign higher probabilities of
a pressure ulcer to around 82% of patients who go on to develop an ulcer
compared to patients that don’t.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fx_nmb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cost_of_pi</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span>  <span class="va">eff_pup</span> <span class="op">&lt;-</span> <span class="fl">0.96</span></span>
<span>  <span class="va">cost_pup</span> <span class="op">&lt;-</span> <span class="fl">140</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span> <span class="op">*</span> <span class="va">eff_pup</span> <span class="op">-</span> <span class="va">cost_pup</span>, <span class="co"># True positive = Correctly predicted event savings - intervention cost</span></span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_pup</span>, <span class="co"># False positive: Cost of (unnecessary) treatment from incorrectly predicted positive</span></span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>, <span class="co"># True negative: No cost of treatment or event from correctly predicted negative</span></span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span> <span class="co"># False negative: Full cost of event from incorrectly predicted negative</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fx_nmb</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    TP    FP    TN    FN </span></span>
<span><span class="co">#&gt; -7820  -140     0 -8000</span></span></code></pre></div>
<p>For a first pass, we want to see how our current values affect the
estimated NMB from model implementation. We will just use our best
guesses for now, but for a rigorous simulation, we will want to use
Monte Carlo methods to sample from input distributions.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmb_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/do_nmb_sim.html">do_nmb_sim</a></span><span class="op">(</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">1000</span>, <span class="co"># Evaluating a theoretical cohort of 1,000 patients</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>, <span class="co"># The larger the number of samples, the longer it takes to run, but the more reproducible the results</span></span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>, <span class="co"># Number of times the NMB is evaluated under each cutpoint</span></span>
<span>  sim_auc <span class="op">=</span> <span class="fl">0.82</span>, <span class="co"># The AUC of our proposed model</span></span>
<span>  event_rate <span class="op">=</span> <span class="fl">0.1</span>, <span class="co"># The incidence of pressure ulcers at our hypothetical hospital</span></span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">fx_nmb</span>, <span class="co"># As a first pass, we will just use our confusion matrix vector above for training and evaluation</span></span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">fx_nmb</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nmb_simulation</span></span>
<span><span class="co">#&gt; predictNMB object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data sample size:  1000</span></span>
<span><span class="co">#&gt; Minimum number of events in training sample:  100</span></span>
<span><span class="co">#&gt; Evaluation data sample size:  10000</span></span>
<span><span class="co">#&gt; Number of simulations:  500</span></span>
<span><span class="co">#&gt; Simulated AUC:  0.82</span></span>
<span><span class="co">#&gt; Simulated event rate:  0.1</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_summary_table.html">make_summary_table</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">)</span> <span class="co"># Get the median incremental NMB for each threshold selection method</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   method           median `95% CI`        </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> all               -<span style="color: #BB0000;">907.</span> -954.9 to -862.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cost minimising   -<span style="color: #BB0000;">798.</span> -847.1 to -751  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> index of union    -<span style="color: #BB0000;">818.</span> -866.1 to -771.7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> none              -<span style="color: #BB0000;">799.</span> -848.8 to -752.8</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> prod sens spec    -<span style="color: #BB0000;">818.</span> -866.9 to -772.6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> roc01             -<span style="color: #BB0000;">818.</span> -865.5 to -772.4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> value optimising  -<span style="color: #BB0000;">798.</span> -847.2 to -751.2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> youden            -<span style="color: #BB0000;">818.</span> -873.1 to -772.1</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"cutpoints"</span><span class="op">)</span> <span class="co"># Demonstrates the range of selected cutpoints under each method</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"inb"</span>, inb_ref_col <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="co"># Compares the incremental benefit of each alternate strategy to our current practice (treat all)</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Our first pass shows treating all likely to be an undesirable option,
outperformed by every other method (as the reference strategy, treat all
has an NMB of 0). Treat none looks like a good choice; we should
definitely consider not using the intervention and look for something
else that either costs less or provides better results. However, this
doesn’t tell the full story. There may be some incremental benefit from
using a model to select patients depending on how our input values
change, as the median for value-optimising and cost-minimising
strategies is higher than treating none. So our intervention might be
worth using, but only for the highest risk patients. Results from the
ROC-based methods like the Youden index and index of union are quite
uncertain, so we may not want to use them for these input parameters.
However, the utility of these models and the threshold selection methods
based on the ROC might improve as they get more accurate, or as the
event rate increases; what we really want to know is how robust our
results are to changes in the input parameters. This is the purpose of
<code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code>. We can not only simulate from a
distribution for our cost inputs, we can pass a vector to the AUC and
incidence arguments to understand how these impact our findings.</p>
<p>First, let’s specify our sampler function for the confusion matrix.
We can replace our inputs with normal distributions, as our values are
all means. Make sure to pass distribution definitions within the
function so that they are resampled every simulation, but pull the same
value for the same patient.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fx_nmb_sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cost_of_pi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">8000</span>, sd <span class="op">=</span> <span class="fl">550</span><span class="op">)</span></span>
<span>  <span class="va">eff_pup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0.04</span>, sd <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span>  <span class="va">cost_pup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">140</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">eff_pup</span><span class="op">)</span> <span class="op">-</span> <span class="va">cost_pup</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_pup</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        TP        FP        TN        FN </span></span>
<span><span class="co">#&gt; -7886.826  -106.423     0.000 -7700.198</span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -8543.7854  -150.0399     0.0000 -8572.9199</span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -8352.5694  -158.6065     0.0000 -8979.4518</span></span></code></pre></div>
<p>The sampler function shows that we can expect some significant
variation, especially due to the probability that our intervention is
effective. It’s always possible that an intervention could lead to worse
patient outcomes. In our case, some true positives could actually be
worse than false negatives!</p>
<p>We should also check whether changing the other inputs can lead to
different results. Perhaps the authors of the clinical prediction model
reported a misleading AUC and when we implement the model it turns out
to be lower, or perhaps our pressure ulcer rate in some wards is
actually quite different to the average incidence at the hospital. By
replacing our <code>sim_auc</code> and <code>event_rate</code> arguments
with vectors, we can run simulations for each possible combination we
are interested in.</p>
<p>In the snippet below, we will compare the treat all strategy to total
disinvestment from the intervention (“none”) and to a couple of
alternative, model-guided strategies, using the “value_optimising” and
“youden” thresholds.</p>
<p>We can also do this in parallel to speed things up.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sim_pup_screen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs</a></span><span class="op">(</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.72</span>, <span class="fl">0.92</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="fl">0.18</span><span class="op">)</span>,</span>
<span>  cutpoint_methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"none"</span>, <span class="st">"value_optimising"</span>, <span class="st">"youden"</span><span class="op">)</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">fx_nmb</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">fx_nmb_sampler</span>,</span>
<span>  cl <span class="op">=</span> <span class="va">cl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_summary_table.html">make_summary_table</a></span><span class="op">(</span><span class="va">sim_pup_screen</span><span class="op">)</span></span>
<span><span class="co">#&gt;    sim_auc event_rate all_median         all_95% CI none_median</span></span>
<span><span class="co">#&gt; 1     0.72       0.02    -294.78   -342.9 to -240.6     -160.15</span></span>
<span><span class="co">#&gt; 2     0.72       0.10    -908.60  -1032.6 to -782.4     -801.71</span></span>
<span><span class="co">#&gt; 3     0.72       0.18   -1515.77 -1743.1 to -1331.5    -1440.44</span></span>
<span><span class="co">#&gt; 4     0.77       0.02    -293.38   -345.8 to -246.1     -159.82</span></span>
<span><span class="co">#&gt; 5     0.77       0.10    -912.09  -1039.8 to -764.2     -802.46</span></span>
<span><span class="co">#&gt; 6     0.77       0.18   -1509.43 -1759.8 to -1301.7    -1433.74</span></span>
<span><span class="co">#&gt; 7     0.82       0.02    -291.30   -345.1 to -243.4     -159.20</span></span>
<span><span class="co">#&gt; 8     0.82       0.10    -907.46  -1050.7 to -782.8     -800.65</span></span>
<span><span class="co">#&gt; 9     0.82       0.18   -1523.99 -1772.7 to -1315.9    -1439.74</span></span>
<span><span class="co">#&gt; 10    0.87       0.02    -293.15   -348.6 to -244.8     -159.90</span></span>
<span><span class="co">#&gt; 11    0.87       0.10    -906.40  -1040.7 to -790.7     -804.17</span></span>
<span><span class="co">#&gt; 12    0.87       0.18   -1524.26 -1740.5 to -1299.3    -1435.54</span></span>
<span><span class="co">#&gt; 13    0.92       0.02    -290.35     -342 to -245.5     -159.34</span></span>
<span><span class="co">#&gt; 14    0.92       0.10    -901.26  -1047.9 to -785.7     -795.97</span></span>
<span><span class="co">#&gt; 15    0.92       0.18   -1519.14 -1744.1 to -1303.1    -1439.19</span></span>
<span><span class="co">#&gt;           none_95% CI value optimising_median value optimising_95% CI</span></span>
<span><span class="co">#&gt; 1    -193.6 to -128.3                 -160.25        -194.5 to -128.3</span></span>
<span><span class="co">#&gt; 2      -919 to -683.2                 -803.72        -918.2 to -683.2</span></span>
<span><span class="co">#&gt; 3    -1645.2 to -1250                -1440.97      -1646.7 to -1255.1</span></span>
<span><span class="co">#&gt; 4    -190.7 to -131.8                 -159.99        -191.7 to -131.9</span></span>
<span><span class="co">#&gt; 5      -922 to -669.8                 -801.33        -920.9 to -670.1</span></span>
<span><span class="co">#&gt; 6    -1645.1 to -1235                -1429.26      -1639.9 to -1234.9</span></span>
<span><span class="co">#&gt; 7    -191.9 to -128.2                 -159.37        -192.3 to -128.8</span></span>
<span><span class="co">#&gt; 8    -922.8 to -685.8                 -799.43        -919.9 to -684.1</span></span>
<span><span class="co">#&gt; 9  -1669.2 to -1248.3                -1433.14      -1664.3 to -1237.3</span></span>
<span><span class="co">#&gt; 10   -190.8 to -131.2                 -159.95        -191.6 to -131.3</span></span>
<span><span class="co">#&gt; 11   -920.9 to -702.1                 -798.92        -911.9 to -693.7</span></span>
<span><span class="co">#&gt; 12   -1644 to -1228.6                -1432.46      -1636.3 to -1228.7</span></span>
<span><span class="co">#&gt; 13   -191.4 to -130.8                 -159.69          -192.7 to -130</span></span>
<span><span class="co">#&gt; 14   -922.8 to -698.2                 -788.31        -918.6 to -683.2</span></span>
<span><span class="co">#&gt; 15   -1650 to -1248.3                -1425.44      -1636.2 to -1235.4</span></span>
<span><span class="co">#&gt;    youden_median      youden_95% CI</span></span>
<span><span class="co">#&gt; 1        -201.75   -260.3 to -154.3</span></span>
<span><span class="co">#&gt; 2        -831.00   -956.2 to -700.8</span></span>
<span><span class="co">#&gt; 3       -1456.68 -1667.1 to -1270.9</span></span>
<span><span class="co">#&gt; 4        -196.45     -246.7 to -151</span></span>
<span><span class="co">#&gt; 5        -832.21   -943.9 to -689.4</span></span>
<span><span class="co">#&gt; 6       -1441.45   -1673 to -1239.5</span></span>
<span><span class="co">#&gt; 7        -187.98     -246 to -148.5</span></span>
<span><span class="co">#&gt; 8        -817.29   -944.2 to -692.3</span></span>
<span><span class="co">#&gt; 9       -1446.89 -1690.8 to -1245.9</span></span>
<span><span class="co">#&gt; 10       -182.04     -237.4 to -144</span></span>
<span><span class="co">#&gt; 11       -810.61     -936 to -706.1</span></span>
<span><span class="co">#&gt; 12      -1439.75 -1643.9 to -1224.4</span></span>
<span><span class="co">#&gt; 13       -171.11   -220.3 to -137.2</span></span>
<span><span class="co">#&gt; 14       -798.81   -935.5 to -688.2</span></span>
<span><span class="co">#&gt; 15      -1431.48   -1649.9 to -1226</span></span></code></pre></div>
<p>As our event rate increases, treatment decisions based on the model,
like the Youden index, begin to look better, but there are still very
marginal gains from using the prediction model regardless of threshold.
It might be that the intervention could be beneficial mostly in settings
where patients are at a very high risk. If the event rates 0.02, 0.10
and 0.18 corresponded to different wards of the hospital, our simulation
could represent the estimated effectiveness of different strategies in
each setting.</p>
<p>We can also represent these results visually.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.02</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.1</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-2.png" width="672"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.18</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-3.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"event_rate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than event_rate, are being held constant:</span></span>
<span><span class="co">#&gt; sim_auc: 0.72</span></span></code></pre></div>
<p><img src="detailed-example_files/figure-html/unnamed-chunk-7-4.png" width="672"></p>
<p>The nice thing about our cost-effectiveness function is that it tends
to follow the best threshold, regardless of AUC or event rate. In this
case, it tends to follow the treat none decision as it moves across,
which is why the strategies for treat none and cost-effective overlap in
the plots. We can also see that the Youden index begins to look better
at higher accuracy and higher incidence rates, but predicting what
patients will get a pressure ulcer is challenging.</p>
<p>Ultimately at our given AUC and event rate, it might be best to stop
using the intervention for the time being across all patients. This is
actually the finding in the analysis this vignette was based off, a
cost-effectiveness analysis of a pressure ulcer prevention care bundle
by Whitty et al in 2017 (<a href="https://doi.org/10.1016/j.ijnurstu.2017.06.014" class="external-link">10.1016/j.ijnurstu.2017.06.014</a>).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rex Parsons, Robin Blythe, Adrian Barnett.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
