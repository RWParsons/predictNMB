<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="predictNMB">
<title>Introduction to predictNMB • predictNMB</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to predictNMB">
<meta property="og:description" content="predictNMB">
<meta property="og:image" content="https://rwparsons.github.io/predictNMB/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">predictNMB</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/creating-nmb-functions.html">Creating NMB functions</a>
    <a class="dropdown-item" href="../articles/introduction-to-predictNMB.html">Introduction to predictNMB</a>
    <a class="dropdown-item" href="../articles/summarising-results-with-predictNMB.html">Summarising results from predictNMB</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rwparsons/predictNMB/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="introduction-to-predictNMB_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Introduction to predictNMB</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rwparsons/predictNMB/blob/HEAD/vignettes/introduction-to-predictNMB.Rmd" class="external-link"><code>vignettes/introduction-to-predictNMB.Rmd</code></a></small>
      <div class="d-none name"><code>introduction-to-predictNMB.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="predictnmb">
<code>{predictNMB}</code><a class="anchor" aria-label="anchor" href="#predictnmb"></a>
</h2>
<p><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a> can be used to evaluate existing or hypothetical clinical prediction models based on their Net Monetary Benefit (NMB). This can be relevant to both prognostic and diagnostic models where a cutpoint (AKA, probability threshold) is used to generate predicted classes rather than probabilities. While it is often beneficial in clinical settings to present the user with a predicted probability, it may be helpful in certain cases to simulate the effect of the decision arising from this probability. For example, in a hospital setting, a user might want to specify the probability threshold for a clinical prediction model at which best practice suggests treatment over non-treatment as the default strategy. By weighing the NMB of these decisions, users can assess the impact of the model and the suggested threshold prior to implementation.</p>
<p><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a> was born out of related work that investigates cutpoint selection methods which maximise the NMB, and includes several options for inbuilt and user-specified cutpoint selection functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rwparsons.github.io/predictNMB/">predictNMB</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="whats-being-simulated">What’s being simulated?<a class="anchor" aria-label="anchor" href="#whats-being-simulated"></a>
</h3>
<p>When <code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> is run, many datasets are created, and models are fit and evaluated based on their NMB. To evaluate NMB, the user is required to specify functions that define each square of the confusion matrix, which arises from binary classification:</p>
<ul>
<li>TP: True Positives, correctly predicted events that lead to necessary treatment</li>
<li>TN: True Negatives, correctly predicted non-events that avoid unnecessary treatment</li>
<li>FP: False Positives, incorrectly predicted positives that lead to unnecessary treatment</li>
<li>FN: False Negatives, incorrectly predicted non-events that lead to a lack of necessary treatment</li>
</ul>
<p>These are presented as a function so that we can repeatedly sample from it to get uncertainty estimates. We might want to sample from a distribution for uncertain parameters (for example, TP and FN) or use constants for parameters we are certain of (here, TN and FP). The function returns a vector representing each square of the matrix when called.</p>
<div class="section level4">
<h4 id="example-function">Example function<a class="anchor" aria-label="anchor" href="#example-function"></a>
</h4>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_nmb_sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">80</span>, sd <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="../reference/get_nmb_sampler.html">get_nmb_sampler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         TN         FP         FN </span></span>
<span><span class="co">#&gt;  -73.14521    0.00000  -20.00000 -105.64698</span></span>
<span><span class="fu"><a href="../reference/get_nmb_sampler.html">get_nmb_sampler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        TP        TN        FP        FN </span></span>
<span><span class="co">#&gt; -78.18436   0.00000 -20.00000 -93.67137</span></span>
<span><span class="fu"><a href="../reference/get_nmb_sampler.html">get_nmb_sampler</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         TN         FP         FN </span></span>
<span><span class="co">#&gt;  -77.97866    0.00000  -20.00000 -101.06125</span></span></code></pre></div>
<p>Every time we run this function, we get a new named vector for the NMB associated with each prediction. We can inform the distributions that we sample from based on the literature for the specific clinical prediction model at hand. See the examples at the end for a more in-depth example based on the literature.</p>
<p>Since we would expect to use our best estimates, in this case the expected value of the NMB associated with each prediction for an actual model (and not take a random sample from its underlying distributions), we will make a separate function for the purpose of obtaining the cutpoint, separately from the one we used (above) to evaluate it.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">get_nmb_sampler_training</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">80</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="fl">100</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">get_nmb_sampler_training</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   TP   TN   FP   FN </span></span>
<span><span class="co">#&gt;  -80    0  -20 -100</span></span></code></pre></div>
<p>These inputs can be passed to <code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code> under the parameters <code>fx_nmb_training</code> and <code>fx_nmb_evaluation</code>, to be evaluated in each simulation.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="do_nmb_sim">
<code>do_nmb_sim()</code><a class="anchor" aria-label="anchor" href="#do_nmb_sim"></a>
</h2>
<p><code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> does a single simulation with a set of inputs for the hypothetical model and NMB related functions. For the model, we need to know the sample size for training and evaluation sets, the model’s discrimination (Area Under the Receiver Operating Characteristic Curve, also known as the Area Under the Curve, or AUC) and the event rate of the outcome being predicted.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmb_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/do_nmb_sim.html">do_nmb_sim</a></span><span class="op">(</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fl">0.7</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">get_nmb_sampler_training</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">get_nmb_sampler</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nmb_simulation</span></span>
<span><span class="co">#&gt; predictNMB object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data sample size:  1000</span></span>
<span><span class="co">#&gt; Minimum number of events in training sample:  100</span></span>
<span><span class="co">#&gt; Evaluation data sample size:  10000</span></span>
<span><span class="co">#&gt; Number of simulations:  500</span></span>
<span><span class="co">#&gt; Simulated AUC:  0.7</span></span>
<span><span class="co">#&gt; Simulated event rate:  0.1</span></span></code></pre></div>
<p>We can call simulation outputs like NMB and cutpoints directly from our simulation object, and choose strategies to examine using this list. This is useful to examine histograms or get summary values. For example, our current default strategy might be to treat all, which is the same as setting our probability threshold for treatment to 0:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_result</span><span class="op">$</span><span class="va">all</span>, main <span class="op">=</span> <span class="st">"Simulation results - treat all"</span>, xlab <span class="op">=</span> <span class="st">"Net monetary benefit (NMB)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_result</span><span class="op">$</span><span class="va">all</span><span class="op">)</span></span>
<span><span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">#&gt;  -27.87  -26.39  -25.99  -26.02  -25.66  -24.41</span></span></code></pre></div>
<p>We have options to include multiple cutpoint methods, and the default is to use all of the available inbuilt methods as well as the treat-all and treat-none strategies.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_inbuilt_cutpoint.html">get_inbuilt_cutpoint</a></span><span class="op">(</span>return_all_methods <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "all"              "none"             "value_optimising" "youden"          </span></span>
<span><span class="co">#&gt; [5] "cost_minimising"  "prod_sens_spec"   "roc01"            "index_of_union"</span></span></code></pre></div>
<p>The simulation under the various cutpoints can be visualised using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. The default is to visualise the distributions of NMB across all (500) simulations. In the plot below, the spread (light blue) shows the variability in results due to repeated simulation. The median is represented with the dark blue line in the centre of each distribution.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>Treating all looks like a bad option here. The rest are relatively similar at this AUC and event rate, with an edge to treat none or the thresholds using value optimisation and cost minimisation.</p>
<p>However, we can also use this same function to visualise cutpoints or the incremental net monetary benefit (INB) if we have a known reference strategy, in this case treat-all:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"cutpoints"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"inb"</span>, inb_ref_col <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-8-2.png" width="672"> Compared to treat-all, every alternative looks better, but treating none or using value-optimising/cost-minimising look the best.</p>
<p>We can compare the NMB for each cutpoint method, as before, by accessing the object directly:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_result</span><span class="op">)</span></span>
<span><span class="co">#&gt;   n_sim       all       none value_optimising    youden cost_minimising</span></span>
<span><span class="co">#&gt; 1     1 -25.08691  -9.791819        -9.791819 -14.56210       -9.790418</span></span>
<span><span class="co">#&gt; 2     2 -25.16047 -10.404846       -10.432962 -14.84745      -10.398127</span></span>
<span><span class="co">#&gt; 3     3 -25.37430  -7.751921        -7.863095 -11.30976       -7.760092</span></span>
<span><span class="co">#&gt; 4     4 -27.12287 -10.936631       -10.933125 -15.15321      -10.931125</span></span>
<span><span class="co">#&gt; 5     5 -26.13946  -9.476418        -9.475121 -15.19484       -9.476418</span></span>
<span><span class="co">#&gt; 6     6 -26.12984 -12.631143       -12.586456 -19.13756      -12.621600</span></span>
<span><span class="co">#&gt;   prod_sens_spec     roc01 index_of_union</span></span>
<span><span class="co">#&gt; 1      -14.56210 -13.49478      -13.49478</span></span>
<span><span class="co">#&gt; 2      -14.84745 -14.84745      -14.84745</span></span>
<span><span class="co">#&gt; 3      -11.30976 -13.65652      -13.65652</span></span>
<span><span class="co">#&gt; 4      -15.15321 -15.15321      -15.15321</span></span>
<span><span class="co">#&gt; 5      -15.19484 -15.19484      -15.19484</span></span>
<span><span class="co">#&gt; 6      -16.29397 -16.29397      -16.13769</span></span></code></pre></div>
<p>… and do the same for our selected cutpoints:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">$</span><span class="va">df_thresholds</span><span class="op">)</span></span>
<span><span class="co">#&gt;   n_sim all none value_optimising     youden cost_minimising prod_sens_spec</span></span>
<span><span class="co">#&gt; 1     1   0    1        1.0000000 0.09641938             0.5     0.09641938</span></span>
<span><span class="co">#&gt; 2     2   0    1        0.3627289 0.10026226             0.5     0.10026226</span></span>
<span><span class="co">#&gt; 3     3   0    1        0.3579602 0.13212194             0.5     0.13212194</span></span>
<span><span class="co">#&gt; 4     4   0    1        0.4854135 0.09627723             0.5     0.09627723</span></span>
<span><span class="co">#&gt; 5     5   0    1        0.3615890 0.11192980             0.5     0.11192980</span></span>
<span><span class="co">#&gt; 6     6   0    1        0.4265252 0.07235760             0.5     0.09989894</span></span>
<span><span class="co">#&gt;        roc01 index_of_union</span></span>
<span><span class="co">#&gt; 1 0.11099649     0.11099649</span></span>
<span><span class="co">#&gt; 2 0.10026226     0.10026226</span></span>
<span><span class="co">#&gt; 3 0.09857486     0.09857486</span></span>
<span><span class="co">#&gt; 4 0.09627723     0.09627723</span></span>
<span><span class="co">#&gt; 5 0.11192980     0.11192980</span></span>
<span><span class="co">#&gt; 6 0.09989894     0.10231104</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="screen_simulation_inputs">
<code>screen_simulation_inputs()</code><a class="anchor" aria-label="anchor" href="#screen_simulation_inputs"></a>
</h2>
<p>We may want to investigate what the relative improvement in NMB is when increasing the model performance (AUC) and compare this to the treat all or treat none strategy. The following function assesses the required performance for the model to outperform a default strategy of treat all or treat none. In this example, cutpoints are selected using the Youden index and the cost-effectiveness approach, which maximises NMB.</p>
<p>To do this, we can screen over many of these simulations with different inputs using <code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code>. This function takes the same inputs as <code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> but can take a vector of inputs rather than only a single value. Here, we pass vectors for both the <code>sim_auc</code> and the <code>event_rate</code>.</p>
<p>Here, we run the simulations in parallel by creating a cluster and passing this as an argument. This can also be done to <code><a href="../reference/do_nmb_sim.html">do_nmb_sim()</a></code> in the same way. This can take some time - the fewer cores used, the longer it takes. For more details on running in parallel, see the <code>parallel</code> package.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/parallel/detectCores.html" class="external-link">detectCores</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sim_screen_obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs</a></span><span class="op">(</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.7</span>, <span class="fl">0.95</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">get_nmb_sampler_training</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">get_nmb_sampler</span>,</span>
<span>  cutpoint_methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"none"</span>, <span class="st">"youden"</span>, <span class="st">"value_optimising"</span><span class="op">)</span>,</span>
<span>  cl <span class="op">=</span> <span class="va">cl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span></code></pre></div>
<p>Here we can see that, for our hypothetical costed outcome, the classification model when the cutpoint is selected by maximising the Youden index only out-performs the treat-none strategy when the model has a AUC of about 0.9. This is pretty high, and may be better than the model that we expect to be able to get. Also, when the event rate is 0.1, rather than 0.2, we are only able the match the treat-none strategy when our model has an AUC of 0.95.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_screen_obj</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.2</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_screen_obj</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.1</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-14-2.png" width="672"></p>
</div>
<div class="section level2">
<h2 id="detailed-example">Detailed example<a class="anchor" aria-label="anchor" href="#detailed-example"></a>
</h2>
<p>Economic analysis typically combines information from a variety of sources, including randomised controlled trials, costing studies, and local data. An advantage of simulation is that it can estimate the utility of a proposed intervention prior to implementation.</p>
<p>In this example, we simulate the decision process for a hospital analyst at an Australian hospital with a high rate of pressure injuries, also known as pressure ulcers. Pressure ulcers are significant adverse events for patients, often leading to additional discomfort, prolonged length of hospital stay, and increased costs. The hospital currently has a pressure ulcer prevention program in place, but our analyst is examining whether to implement a clinical prediction model to identify patients who may not benefit from the program and potentially save on costs.</p>
<p>Let’s begin by generating some realistic costs and probabilities. Keep in mind, we are trying to avoid a negative event, so the net monetary benefit of every strategy is going to be negative. In economic parlance, costs are typically negative, while cost savings are positive. If we were also interested in improving quality of life, we could estimate quality-adjusted life years (QALYs), multiply them by a willingness-to-pay threshold (WTP), and add this gain or loss to our true positive and false negative squares to signify the impact on the patient. For simplicity’s sake, let’s say we’re only interested in hospital costs.</p>
<p>Model inputs: <br> - Mean incremental cost per pressure injury: $8,000 (SD 550) <br> - Per-patient cost of pressure ulcer prevention strategy (PUP): $140 (SD 20) <br> - Odds ratio of pressure ulcer with intervention compared to non-intervention: 0.96 (SD 0.03) <br> - AUC: 0.820 (SD 0.02) <br> - Hypothetical hospital pressure injury incidence/event rate: 0.1 (SD 0.02) <br></p>
<p>With these inputs, we can populate our confusion matrix (2x2 table), which helps us understand the outcomes resulting from correct and incorrect predictions.</p>
<div class="section level3">
<h3 id="model-inputs">Model inputs<a class="anchor" aria-label="anchor" href="#model-inputs"></a>
</h3>
<p>First, we need to define our NMB function, which provides data for our simulation. In this case, the intervention is associated with a 4% reduction in the odds of a pressure ulcer, so it’s only moderately effective at reducing the chance of a pressure injury. We can use a probability-weighted cost savings for successful prevention, at 8000*(0.96) = a small improvement of around $320. After including $140 in program costs, the net benefit is around $180 for a successfully prevented pressure ulcer.</p>
<p>The AUC is 0.820, which is essentially the proportion of random positive samples that received a higher probability of an injury than random negative samples (and vice versa). A useful property of the AUC is that it is the same no matter what probability threshold we use. In our case, an AUC of 0.820 means that the model will assign higher probabilities of a pressure ulcer to around 82% of patients who go on to develop one compared to patients that don’t.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">fx_nmb</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cost_of_pi</span> <span class="op">&lt;-</span> <span class="fl">8000</span></span>
<span>  <span class="va">eff_pup</span> <span class="op">&lt;-</span> <span class="fl">0.96</span></span>
<span>  <span class="va">cost_pup</span> <span class="op">&lt;-</span> <span class="fl">140</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span><span class="op">*</span><span class="va">eff_pup</span> <span class="op">-</span> <span class="va">cost_pup</span>, <span class="co"># True positive = Correctly predicted event savings - intervention cost</span></span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_pup</span>,                      <span class="co"># False positive: Cost of (unnecessary) treatment from incorrectly predicted positive</span></span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,                              <span class="co"># True negative: No cost of treatment or event from correctly predicted negative</span></span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span>                     <span class="co"># False negative: Full cost of event from incorrectly predicted negative</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fx_nmb</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;    TP    FP    TN    FN </span></span>
<span><span class="co">#&gt; -7820  -140     0 -8000</span></span></code></pre></div>
<p>For a first pass, we want to see how our current values affect the estimated NMB from model implementation. We will just use our best guesses for now, but for a rigorous simulation, we will want to use Monte Carlo methods to sample from input distributions.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nmb_simulation</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/do_nmb_sim.html">do_nmb_sim</a></span><span class="op">(</span></span>
<span>  sample_size <span class="op">=</span> <span class="fl">1000</span>,         <span class="co"># Evaluating a theoretical cohort of 1,000 patients</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,               <span class="co"># The larger the number of samples, the longer it takes to run, but the more reproducible the results</span></span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,            <span class="co"># Number of times the NMB is evaluated under each cutpoint</span></span>
<span>  sim_auc <span class="op">=</span> <span class="fl">0.820</span>,            <span class="co"># The AUC of our proposed model</span></span>
<span>  event_rate <span class="op">=</span> <span class="fl">0.1</span>,           <span class="co"># The incidence of pressure ulcers at our hypothetical hospital</span></span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">fx_nmb</span>,   <span class="co"># As a first pass, we will just use our confusion matrix vector above for training and evaluation</span></span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">fx_nmb</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">nmb_simulation</span></span>
<span><span class="co">#&gt; predictNMB object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Training data sample size:  1000</span></span>
<span><span class="co">#&gt; Minimum number of events in training sample:  100</span></span>
<span><span class="co">#&gt; Evaluation data sample size:  10000</span></span>
<span><span class="co">#&gt; Number of simulations:  500</span></span>
<span><span class="co">#&gt; Simulated AUC:  0.82</span></span>
<span><span class="co">#&gt; Simulated event rate:  0.1</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_summary_table.html">make_summary_table</a></span><span class="op">(</span><span class="va">nmb_simulation</span><span class="op">)</span>                      <span class="co"># Get the mean incremental NMB for each threshold selection method</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 8 × 3</span></span></span>
<span><span class="co">#&gt;   method           median `95% CI`          </span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> all               -<span style="color: #BB0000;">908</span>  -953.35 to -862.65</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> cost_minimising   -<span style="color: #BB0000;">799.</span> -845.13 to -751.67</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> index_of_union    -<span style="color: #BB0000;">818.</span> -866.22 to -770.05</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> none              -<span style="color: #BB0000;">800</span>  -847.24 to -752.76</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> prod_sens_spec    -<span style="color: #BB0000;">819.</span> -865.72 to -770.37</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> roc01             -<span style="color: #BB0000;">817.</span> -866.22 to -770.12</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span> value_optimising  -<span style="color: #BB0000;">799.</span> -845.02 to -752.02</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span> youden            -<span style="color: #BB0000;">820.</span> -872.62 to -769.95</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"cutpoints"</span><span class="op">)</span>                <span class="co"># Demonstrates the range of selected cutpoints under each method</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">nmb_simulation</span>, what <span class="op">=</span> <span class="st">"inb"</span>, inb_ref_col <span class="op">=</span> <span class="st">"all"</span><span class="op">)</span> <span class="co"># Compares the incremental benefit of each alternate strategy to our current practice (treat all)</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-16-2.png" width="672"></p>
<p>Our first pass shows that based on the inputs we’ve given the simulation model, treating all is a bad option, outperformed by every other method (as the reference strategy, treat all has an NMB of 0). Treat none looks like a good choice; we should definitely consider scrapping the program and looking for something else that costs less or provides better results. However, this doesn’t tell the full story. There may be some incremental benefit from using a model to select patients depending on how our input values change, as the median for value-optimising and cost-minimising strategies is higher than treating none. So our intervention might be worth using, but only for the highest risk patients. Results from the ROC-based methods like the Youden index and index of union are quite uncertain, so we may not want to use them for these input parameters. However, the utility of these models and the threshold selection methods based on the ROC might improve as they get more accurate, or as the event rate increases; what we really want to know is how robust our results are to changes in the input parameters. This is the purpose of <code><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs()</a></code>. We can not only simulate from a distribution for our cost inputs, we can pass a vector to the AUC and incidence arguments to understand how these impact our findings.</p>
<p>First, let’s specify our sampler function for the confusion matrix. We can replace our inputs with normal distributions, as our values are all means. Make sure to pass distribution definitions within the function so that they are resampled every simulation, but pull the same value for the same patient.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fx_nmb_sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">cost_of_pi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">8000</span>, sd <span class="op">=</span> <span class="fl">550</span><span class="op">)</span></span>
<span>  <span class="va">eff_pup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">0.04</span>, sd <span class="op">=</span> <span class="fl">0.03</span><span class="op">)</span></span>
<span>  <span class="va">cost_pup</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, mean <span class="op">=</span> <span class="fl">140</span>, sd <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"TP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span><span class="op">*</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">eff_pup</span><span class="op">)</span> <span class="op">-</span> <span class="va">cost_pup</span>,</span>
<span>    <span class="st">"FP"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_pup</span>,</span>
<span>    <span class="st">"TN"</span> <span class="op">=</span> <span class="fl">0</span>,</span>
<span>    <span class="st">"FN"</span> <span class="op">=</span> <span class="op">-</span><span class="va">cost_of_pi</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -7042.5122  -133.3547     0.0000 -7385.5877</span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;         TP         FP         TN         FN </span></span>
<span><span class="co">#&gt; -7556.6643  -126.0965     0.0000 -7656.1310</span></span>
<span><span class="fu">fx_nmb_sampler</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;        TP        FP        TN        FN </span></span>
<span><span class="co">#&gt; -8464.225  -155.367     0.000 -8405.697</span></span></code></pre></div>
<p>The sampler function shows that we can expect some significant variation, especially due to the probability that our intervention is effective. It’s always possible that an intervention could lead to worse patient outcomes. In our case, some true positives could actually be worse than false negatives!</p>
<p>We should also check whether changing the other inputs can lead to different results. Perhaps the authors of the clinical prediction model we want to use reported a misleading AUC and when we implement the model it turns out to be lower, or perhaps our pressure ulcer rate in some wards is actually quite different to the average incidence at the hospital. By replacing our <code>sim_auc</code> and <code>event_rate</code> arguments with vectors, we can run simulations for each possible combination we are interested in.</p>
<p>In the snippet below, we will compare the treat all strategy to scrapping the program altogether (“none”) and to a couple of alternative strategies, using the “value_optimising” and “youden” thresholds.</p>
<p>We can also do this in parallel to speed things up.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">makeCluster</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">sim_pup_screen</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/screen_simulation_inputs.html">screen_simulation_inputs</a></span><span class="op">(</span></span>
<span>  n_sims <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n_valid <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  sim_auc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0.72</span>, <span class="fl">0.92</span>, <span class="fl">0.05</span><span class="op">)</span>,</span>
<span>  event_rate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.02</span>, <span class="fl">0.1</span>, <span class="fl">0.18</span><span class="op">)</span>,</span>
<span>  cutpoint_methods <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"all"</span>, <span class="st">"none"</span>, <span class="st">"value_optimising"</span>, <span class="st">"youden"</span><span class="op">)</span>,</span>
<span>  fx_nmb_training <span class="op">=</span> <span class="va">fx_nmb</span>,</span>
<span>  fx_nmb_evaluation <span class="op">=</span> <span class="va">fx_nmb_sampler</span>,</span>
<span>  cl <span class="op">=</span> <span class="va">cl</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/parallel/makeCluster.html" class="external-link">stopCluster</a></span><span class="op">(</span><span class="va">cl</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/make_summary_table.html">make_summary_table</a></span><span class="op">(</span><span class="va">sim_pup_screen</span><span class="op">)</span></span>
<span><span class="co">#&gt;    sim_auc event_rate all_median           all_95% CI none_median</span></span>
<span><span class="co">#&gt; 1     0.72       0.02  -294.0098    -343.05 to -241.5   -159.0951</span></span>
<span><span class="co">#&gt; 2     0.72       0.10  -907.0494  -1033.11 to -792.59   -799.9717</span></span>
<span><span class="co">#&gt; 3     0.72       0.18 -1519.1501 -1734.56 to -1328.19  -1446.2625</span></span>
<span><span class="co">#&gt; 4     0.77       0.02  -290.6816   -346.03 to -246.65   -160.2028</span></span>
<span><span class="co">#&gt; 5     0.77       0.10  -905.2370  -1048.89 to -779.64   -798.3858</span></span>
<span><span class="co">#&gt; 6     0.77       0.18 -1510.7080 -1737.94 to -1286.17  -1431.6430</span></span>
<span><span class="co">#&gt; 7     0.82       0.02  -293.0441   -347.52 to -243.83   -159.8185</span></span>
<span><span class="co">#&gt; 8     0.82       0.10  -910.3898  -1048.36 to -783.76   -803.0191</span></span>
<span><span class="co">#&gt; 9     0.82       0.18 -1517.0059 -1767.73 to -1308.84  -1435.3583</span></span>
<span><span class="co">#&gt; 10    0.87       0.02  -293.4287   -343.71 to -248.94   -159.5600</span></span>
<span><span class="co">#&gt; 11    0.87       0.10  -906.5400  -1033.83 to -778.96   -798.7997</span></span>
<span><span class="co">#&gt; 12    0.87       0.18 -1525.6414 -1741.33 to -1286.46  -1439.2603</span></span>
<span><span class="co">#&gt; 13    0.92       0.02  -291.5793   -334.54 to -247.79   -158.3857</span></span>
<span><span class="co">#&gt; 14    0.92       0.10  -904.7667    -1041.7 to -785.3   -802.5538</span></span>
<span><span class="co">#&gt; 15    0.92       0.18 -1520.0207  -1736.5 to -1316.22  -1438.2223</span></span>
<span><span class="co">#&gt;             none_95% CI value_optimising_median value_optimising_95% CI</span></span>
<span><span class="co">#&gt; 1    -190.67 to -128.74               -159.2508       -192.6 to -128.74</span></span>
<span><span class="co">#&gt; 2    -921.86 to -685.62               -800.9776      -923.16 to -685.81</span></span>
<span><span class="co">#&gt; 3  -1653.09 to -1245.56              -1446.9537    -1644.87 to -1242.31</span></span>
<span><span class="co">#&gt; 4       -190.34 to -130               -160.4644      -191.43 to -130.05</span></span>
<span><span class="co">#&gt; 5    -922.32 to -686.45               -798.9079      -920.53 to -683.85</span></span>
<span><span class="co">#&gt; 6  -1629.54 to -1223.59              -1426.4185     -1621.52 to -1220.1</span></span>
<span><span class="co">#&gt; 7    -189.69 to -129.13               -160.1441       -191.02 to -129.5</span></span>
<span><span class="co">#&gt; 8    -921.98 to -687.56               -801.9826      -919.38 to -686.88</span></span>
<span><span class="co">#&gt; 9   -1675.3 to -1242.08              -1432.1946     -1663.3 to -1235.91</span></span>
<span><span class="co">#&gt; 10   -193.77 to -133.37               -159.6661      -194.38 to -133.45</span></span>
<span><span class="co">#&gt; 11   -918.82 to -694.69               -796.3212       -912.61 to -692.2</span></span>
<span><span class="co">#&gt; 12 -1627.28 to -1235.42              -1431.9797    -1632.74 to -1220.97</span></span>
<span><span class="co">#&gt; 13   -191.63 to -130.65               -158.4652      -191.83 to -130.52</span></span>
<span><span class="co">#&gt; 14   -932.98 to -689.77               -796.0005      -924.51 to -689.06</span></span>
<span><span class="co">#&gt; 15 -1631.21 to -1248.92              -1423.3079    -1611.05 to -1229.27</span></span>
<span><span class="co">#&gt;    youden_median        youden_95% CI</span></span>
<span><span class="co">#&gt; 1      -200.7229    -254.2 to -155.01</span></span>
<span><span class="co">#&gt; 2      -830.2228   -961.37 to -710.18</span></span>
<span><span class="co">#&gt; 3     -1459.3749 -1664.66 to -1268.89</span></span>
<span><span class="co">#&gt; 4      -194.1191    -250.88 to -149.7</span></span>
<span><span class="co">#&gt; 5      -825.5715   -961.49 to -700.89</span></span>
<span><span class="co">#&gt; 6     -1444.7984    -1650.62 to -1228</span></span>
<span><span class="co">#&gt; 7      -188.1966    -240.9 to -144.08</span></span>
<span><span class="co">#&gt; 8      -820.2371    -950.7 to -705.15</span></span>
<span><span class="co">#&gt; 9     -1440.7861 -1682.18 to -1242.28</span></span>
<span><span class="co">#&gt; 10     -182.1017   -234.75 to -145.36</span></span>
<span><span class="co">#&gt; 11     -808.7998      -940 to -702.21</span></span>
<span><span class="co">#&gt; 12    -1442.5000 -1645.46 to -1218.62</span></span>
<span><span class="co">#&gt; 13     -172.1057    -217.5 to -138.72</span></span>
<span><span class="co">#&gt; 14     -801.7241    -931.67 to -690.8</span></span>
<span><span class="co">#&gt; 15    -1429.0024  -1632.34 to -1232.6</span></span></code></pre></div>
<p>We can see from these results that as our event rate increases, treatment decisions based on the model, like the Youden index, begin to look better, but there are still very marginal gains from using the prediction model regardless of threshold. It might be that the program could be beneficial mostly in those settings where patients are at a very high risk. If the event rates 0.02, 0.10 and 0.18 corresponded to different wards of the hospital, our simulation could represent the estimated effectiveness of different strategies in each setting.</p>
<p>We can also represent these results visually.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.02</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.02</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.10</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.1</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-19-2.png" width="672"></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"sim_auc"</span>, constants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>event_rate <span class="op">=</span> <span class="fl">0.18</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than sim_auc, are being held constant:</span></span>
<span><span class="co">#&gt; event_rate: 0.18</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-19-3.png" width="672"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sim_pup_screen</span>, x_axis_var <span class="op">=</span> <span class="st">"event_rate"</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Varying simulation inputs, other than event_rate, are being held constant:</span></span>
<span><span class="co">#&gt; sim_auc: 0.72</span></span></code></pre></div>
<p><img src="introduction-to-predictNMB_files/figure-html/unnamed-chunk-19-4.png" width="672"></p>
<p>The nice thing about our cost-effectiveness function is that it tends to follow the best threshold, regardless of AUC or event rate. In this case, it tends to follow the treat none decision as it moves across, which is why the strategies for treat none and cost-effective overlap in the plots. We can also see that the Youden index begins to look better at higher accuracy and higher incidence rates, but predicting what patients will get a pressure ulcer is challenging.</p>
<p>Ultimately at our given AUC and event rate, it might be best to stop using the intervention for the time being across all patients. This is actually the finding in the analysis this vignette was based off, a cost-effectiveness analysis of a pressure ulcer prevention care bundle by Whitty et al in 2017 (10.1016/j.ijnurstu.2017.06.014).</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Rex Parsons, Robin Blythe, Adrian Barnett.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
